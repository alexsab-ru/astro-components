---
import { type TFaqItem } from './types';
import { Icon } from 'astro-icon/components'
interface Props {
	item: TFaqItem;
	/**
	 * Если true — заголовок аккордеона (item.question) будет выровнен по центру по горизонтали.
	 *
	 * Почему это отдельный проп:
	 * - В обычном режиме справа есть иконка раскрытия, и из-за неё "наивное" text-center
	 *   визуально смещает заголовок влево.
	 * - Поэтому при centerTitle мы переключаем шапку на grid из 3 колонок:
	 *   [левая заглушка][заголовок][иконка].
	 *   Левая заглушка занимает то же место, что и иконка справа — так заголовок
	 *   действительно оказывается по центру.
	 */
	centerTitle?: boolean;
}
const { item, centerTitle = false } = Astro.props;
---

<div
	class="px-5 py-4 rounded-md mb-3 transition hover:bg-gray-200"
	:class={ `activities.includes(${item.id}) ? 'bg-gray-200' : 'bg-gray-100'` }
	x-init={ `${item.open} && activities.push(${item.id})` }
>
	{/* В обычном режиме оставляем flex как было.
		В режиме centerTitle используем grid, чтобы заголовок был по центру независимо от иконки. */}
	<div
		class:list={[
			'items-center cursor-pointer',
			centerTitle ? 'grid grid-cols-[1.25rem_1fr_1.25rem]' : 'flex justify-between',
		]}
		@click={ `activities.includes(${item.id}) ? activities = activities.filter(id => id != ${item.id}) : activities.push(${item.id})` }
	>
		{/* Невидимая "заглушка" слева — занимает место, равное иконке справа.
			Нужна только для идеального визуального центрирования заголовка. */}
		{centerTitle && (
			<span class="text-xl shrink-0 opacity-0">
				<Icon name="mdi:keyboard-arrow-down" />
			</span>
		)}

		<div class:list={['font-weight-bold text-sm md:text-lg', centerTitle && 'text-center']}>
			{item.question}
		</div>

		<span
			class="text-xl transition-transform origin-center shrink-0"
			:class={ `{'-rotate-180': activities.includes(${item.id}) }` }
		>
			{/* Иконке не передаём class напрямую, чтобы TypeScript не ругался на проп `class`.
				Управляем внешним видом через wrapper-элемент. */}
			<Icon name="mdi:keyboard-arrow-down" />
		</span>
	</div>
	<div
		class="mt-3 text-xs md:text-base"
		x-show={ `activities.includes(${item.id})` }
		x-transition.opacity.duration.100ms
	>
		<Fragment set:html={item.answer} />
		<slot />
	</div>
</div>
