---
import settings from '@/data/settings.json';
const { site_name, brand, legal_city_where } = settings;

import Layout from '@/layouts/Layout.astro';

import page from '@/data/pages/home.json';
const { title, description, image, h1, blocks } = page;
const registry = import.meta.glob('@/components/**/*.astro', { eager: true });

function resolveComponent(name) {
	const path = `/src/components/${name}.astro`;
	return registry[path]?.default ?? null;
}

const sections = blocks.filter(block => block.show);

const pageBlocks = sections.map(block => ({
	...block,
	Component: resolveComponent(block.component)
}));
---

<Layout title={title} description={description} image={image} h1={h1}>	
	{pageBlocks.map(block => {
		const Component = block.Component;
		return Component && <Component {...block.props} />;
	})}
</Layout>
